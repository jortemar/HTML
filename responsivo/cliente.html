<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body>
    <div class="container mt-4">
        <!-- LOGO -->
        <div class="row align-items-center">
            <div class="col-lg-2">
                <img src="./recursos/logo.png" class="img-fluid" alt="logo">
            </div>
            <div class="col-lg-10 text-center pt-3">
                <h1 style="font-size: 56px;">Tu compañía de seguros</h1>
                <h5>Contáctanos +34-968-858585</h5>
            </div>
        </div>

        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg bg-light mt-4">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="./index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./cliente.html">Area Clientes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./asistencia.html">Asistencia</a>
                        </li>
                    </ul>
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-sm btn-outline-secondary" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </nav>

        <!-- ENCABEZADO -->
        <div class="row bg-black mt-5">
            <p class="h1 text-center text-white">Solicitar asistencia</p>
        </div>

        <!-- MAPA -->
        <div class="row mt-5 mb-1">
            <div class="col ratio ratio-16x9 border">
                <iframe class="iframe" src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d12495.561342100902!2d-1.31800535!3d38.467093!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1ses!2ses!4v1675823214058!5m2!1ses!2ses" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>

        <!-- BOTÓN UBICACION -->
        <div class="row mb-4">
            <div class="col-12 mt-5 text-center">
                <button id="btn_ubicacion" class="btn btn-primary" type="submit">Mi ubicación</button>
            </div>
        </div>
        
        <!-- COORDENADAS -->
        <div class="row">
            <p id="ubicacion"></p>
        </div>

        <!-- ALERTAS -->
        <div id="liveAlertPlaceholder"></div>

        <!-- FORMULARIO -->       
        <form class="row g-3 mt-2 border p-3 needs-validation" action="asistencia.html" novalidate>
            <p class="h4">Datos personales</p>

            <!-- NOMBRE -->
            <div class="col-md-4">
                <label for="inputNombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="inputNombre" required>   
                <div class="invalid-feedback">
                    Por favor introduzca su nombre
                </div>  
            </div>

            <!-- APELLIDOS -->
            <div class="col-md-5 offset-md-2">
                <label for="inputApellido" class="form-label">Apellidos</label>
                <input type="text" class="form-control" id="inputApellido" required> 
                <div class="invalid-feedback">
                    Por favor introduzca sus apellidos
                </div>            
            </div>

            <!-- DNI/NIE -->
            <div class="col-md-3">
                <label for="inputDNI" class="form-label">DNI/NIE</label>
                <input type="text" class="form-control" id="inputDNI" required>
                <div class="invalid-feedback">
                    Por favor introduzca un DNI o NIE válido
                </div>            
            </div>

            <!-- TELÉFONO -->
            <div class="col-md-3 offset-md-3">
                <label for="inputTelefono" class="form-label">Teléfono</label>
                <input type="number" class="form-control" id="inputTelefono" required>
                <div class="invalid-feedback">
                    Por favor introduzca un teléfono válido
                </div>
            </div>

            <div class="w-100"></div> <!-- SALTO DE LÍNEA -->

            <!-- TIPO DE ASISTENCIA -->           
            <div class="col-md-5">
                <label for="inputAsistencia" class="form-label">Asistencia</label>
                <select class="form-select" id="inputAsistencia" required>
                    <option selected disabled value="">Indique su incidencia</option>
                    <option>Pinchazo</option>
                    <option>Accidente</option>
                    <option>Sin batería</option>
                    <option>Servicio de grúa</option>
                </select>
                <div class="invalid-feedback">
                    Por favor elija una opción
                </div>
            </div>

            <p class="h4 mt-5">Datos del vehículo</p>

            <!-- MARCA -->
            <div class="col-md-4">
                <label for="inputMarca" class="form-label">Marca</label>
                <input type="text" class="form-control" id="inputMarca" required> 
                <div class="invalid-feedback">
                    Por favor introduzca una marca
                </div>         
            </div>

            <!-- MODELO -->    
            <div class="col-md-5 offset-md-2">
                <label for="inputModelo" class="form-label">Modelo</label>
                <input type="text" class="form-control" id="inputModelo" required>   
                <div class="invalid-feedback">
                    Por favor introduzca un modelo
                </div>          
            </div>

            <!-- MATRÍCULA -->
            <div class="col-md-3">
                <label for="inputMatricula" class="form-label">Matrícula</label>
                <input type="text" class="form-control" id="inputMatricula" required>      
                <div class="invalid-feedback">
                    Por favor introduzca una matrícula válida. Cuatro dígitos y tres consonantes, sin separación
                </div>      
            </div>

            <!-- TIPO DE VEHÍCULO -->
            <div class="col-md-4 offset-md-3">
                <label for="inputVehiculo" class="form-label">Tipo de vehículo</label>
                <select class="form-select" id="inputVehiculo" required>
                    <option selected disabled value="">Seleccione su vehículo</option>
                    <option>Automóvil</option>
                    <option>Moto</option>
                    <option>Camión</option>
                    <option>Quad</option>
                    <option>Otro</option>
                </select>
                <div class="invalid-feedback">
                    Por favor elija una opción
                </div>
            </div>

            <!-- OBSERVACIONES -->
            <div class="col-md-12">
                <label for="inputObservaciones" class="form-label">Observaciones</label>
                <textarea type="text" class="form-control" id="inputObservaciones"></textarea>
            </div>

            <!-- BOTÓN ENVIAR -->
            <div class="col-12 mt-5 text-center">
                <button class="btn btn-primary" type="submit" id="submit">Solicitar</button>
            </div>
        </form>     
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
    integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
    crossorigin="anonymous"></script>
    
    <script>
        (() => {
            'use strict'
        
            const forms = document.querySelectorAll('.needs-validation');

            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    // si el formulario no es válido se cancela el evento
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    // si el formulario es válido se le añadirá esta clase
                    form.classList.add('was-validated');
                }, false);
            })
        })()
    </script>

    <script>
        //ALMACENAMOS EL NOMBRE CON LA API WEB STORAGE
        document.querySelector('#submit').addEventListener('click', evento => {
            // Aprovechamos el evento para almacenar también el nombre. Lo recogemos para mostrarlo en la página de asistencia
            //Usamos sessionStorage en lugar de localStorage, para que en cuanto se cierre la web se borren las variables

            const name = document.querySelector('#inputNombre');
            sessionStorage.setItem("name", name.value);
        })
    </script>

    <script>
        //VALIDACIÓN DEL FORMULARIO (y almacenamiento del nombre)
        let dni = document.querySelector("#inputDNI");
        let matricula = document.querySelector("#inputMatricula");
        let formulario = document.querySelector("form");
        let btnSubmit = document.querySelector("#submit");

        btnSubmit.addEventListener("click", evento => {
            let dniRegexp = /^(\d{8})([A-Z])$/i;
            let nieRegexp = /^[XYZ]\d{7,8}[A-Z]$/i;
            let matRegexp = /^[0-9]{1,4}(?!.*(LL|CH))[BCDFGHJKLMNPRSTVWXYZ]{3}$/i;
            
            if ((dniRegexp.test(dni.value) == true || nieRegexp.test(dni.value) == true) && matRegexp.test(matricula.value) == true) {
                alert("La matrícula, y el DNI o NIE, son correctos", "success");               
            } else {
                alert("Introduzca correctamente su matrícula y su DNI o NIE", "danger");
                //con preventDefault() impedimos que se ejecute la acción por defecto, que en este
                //caso es redirigir a otra web. Solo pasará si el DNI es correcto (y no hay más impedimentos).
                evento.preventDefault();
            }
        })

        const alertPlaceholder = document.getElementById("liveAlertPlaceholder");
        const alert = (message, type) => {
            const wrapper = document.createElement('div');
            wrapper.innerHTML = [
                `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                `   <div>${message}</div>`,
                `   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`,
                `</div>`    
            ].join('');

            alertPlaceholder.append(wrapper);
        }
    </script>
    
    <script>
        //MOSTRAR UBICACIÓN
        let ubicacion = document.querySelector('#ubicacion');
        let btnUbicacion = document.querySelector('#btn_ubicacion');
        let myIframe = document.querySelector('.iframe');

        function success(position) {
            const crd = position.coords;
            ubicacion.innerHTML = "Latitud: " + crd.latitude +
            "<br>Longitud: " + crd.longitude;
            //establecemos el atributo src del iframe con un string que contiene la url con las coordenadas que queremos
            //necesitamos meter en el enlace el parámetro 'output', y darle valor 'embed'. Si no saltará un error
            myIframe.setAttribute("src", `https://google.com/maps?output=embed&q=${crd.latitude},${crd.longitude}`);
        }

        btnUbicacion.addEventListener("click", event => {
            if (navigator.geolocation) {
                //getCurrentPosition recibe como parámetro obligatorio una función de callback para cuando el proceso es exitoso.
                //La función entra tal y como está, sin parámetro, a pesar de que como vemos en la definición de la función, esta exige un parámetro
                //Supongo que este parámetro lo aporta de alguna forma el método getCurrentPosition
                //Podemos añadir un segundo parámetro 'error' para cuando el proceso no resulta satisfactorio               
                navigator.geolocation.getCurrentPosition(success);

            } else {
                ubicacion.innerHTML = "Geolocation is not supported by this browser.";
            }
        }); 
    </script>

</body>

</html>